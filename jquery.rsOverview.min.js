// Overview plug-in v3.3 - MIT license - ruisoftware.com
(function(d){var T=function(h,b,r){var u,v,w,x,p=null,l=null,q=b.monitor===window||d(b.monitor).is(d(window)),t=!1,g=0,y=r,z=r,n={$obj:null,sizeX:0,sizeY:0,resized:function(){this.sizeX=this.$obj.width();this.sizeY=this.$obj.height()},resizedOverflow:function(){var a=1==this.$obj[0].children.length?0<this.$obj[0].children[0].children.length?this.$obj[0].children[0]:this.$obj[0]:this.$obj[0];this.sizeX=a.scrollWidth;this.sizeY=a.scrollHeight}},e={$obj:null,sizeX:0,sizeY:0,resized:function(){this.sizeX=
this.$obj.width();this.sizeY=this.$obj.height()}},k={states:{toggle:null,toggleIdx:null,triggerToggle:function(a,f){var c=-1<f;if(c!==this.toggle||c&&f!=this.toggleIdx){b.bookmarkActiveClass&&(k.$allBks.removeClass(b.bookmarkActiveClass),c&&k.$allBks.eq(f).addClass(b.bookmarkActiveClass));c&&(k.currIdx=f);if(c!==this.toggle&&b.onChangeToggle)b.onChangeToggle(a,c);this.toggle=c;this.toggleIdx=f}},prev:null,triggerPrev:function(a,f){b.onChangeCtrlState&&f!==this.prev&&(this.prev=f,b.onChangeCtrlState(a,
"prev",this.prev))},next:null,triggerNext:function(a,f){b.onChangeCtrlState&&f!==this.next&&(this.next=f,b.onChangeCtrlState(a,"next",this.next))},clearAll:null,triggerClearAll:function(a,f){b.onChangeCtrlState&&f!==this.clearAll&&(this.clearAll=f,b.onChangeCtrlState(a,"clear",this.clearAll))}},$allBks:d(),currIdx:-1,qt:0,marks:[],getPnt:function(a){switch(b.direction){case "horizontal":return{scrollLeft:a};case "vertical":return{scrollTop:a};default:return{scrollLeft:a[0],scrollTop:a[1]}}},checkEvents:function(a){b.bookmarkClass&&
(this.states.triggerToggle(a,this.getMarkedIdx()),b.onChangeCtrlState&&(this.states.triggerPrev(a,0<this.currIdx||!1===this.states.toggle&&0===this.currIdx),this.states.triggerNext(a,this.currIdx<this.qt-1),this.states.triggerClearAll(a,0<this.qt)))},arrayIndexOf:function(a){switch(b.direction){case "horizontal":case "vertical":return d.inArray(a,this.marks);default:for(var f=0;f<this.marks.length;++f){var c=this.marks[f];if(c[0]==a[0]&&c[1]==a[1])return f}}return-1},doToggle:function(a,f,c){f="horizontal"==
b.direction?f:"vertical"==b.direction?c:[f,c];c=this.arrayIndexOf(f);if(-1===c){c=l.position();var m=d("<span>").addClass(b.bookmarkClass).css("position","absolute").appendTo(h);b.bookmarkHint&&m.attr("title",b.bookmarkHint);switch(b.direction){case "horizontal":m.css({left:Math.round(c.left+(l.width()-m.outerWidth())/2)+"px",top:0,bottom:0,height:"auto"});break;case "vertical":m.css({left:0,right:0,width:"auto",top:Math.round(c.top+(l.height()-m.outerHeight())/2)+"px"});break;default:m.css({left:Math.round(c.left+
(l.width()-m.outerWidth())/2)+"px",top:Math.round(c.top+(l.height()-m.outerHeight())/2)+"px"})}m.mousedown(function(a){if(!b.readonly){var c=k.$allBks.index(this);-1<c&&c<k.qt&&A(k.getPnt(k.marks[c]),function(){k.checkEvents(a)});return!1}});this.marks.push(f);this.$allBks=this.$allBks.add(m);this.qt=this.marks.length;this.currIdx=this.qt-1}else this.marks.splice(c,1),this.$allBks.eq(c).remove(),this.$allBks.splice(c,1),this.qt=this.marks.length,this.currIdx>=this.qt&&(this.currIdx=this.qt-1);a&&
this.checkEvents(a)},toggle:function(a){this.doToggle(a,n.$obj.scrollLeft(),n.$obj.scrollTop())},doClearAll:function(a){this.qt=this.marks.length=0;this.currIdx=-1;this.$allBks.remove();this.$allBks=d();a&&this.checkEvents(a)},clearAll:function(a){this.doClearAll(a)},go:function(a,b){return-1<a&&a<this.qt?(A(this.getPnt(this.marks[a]),b),!0):!1},gotoPrev:function(a){if(0<this.currIdx||!1===this.states.toggle)!1!==this.states.toggle&&this.currIdx--,this.go(this.currIdx,function(){k.checkEvents(a)})},
gotoNext:function(a){this.currIdx<this.qt-1&&(this.currIdx++,this.go(this.currIdx,function(){k.checkEvents(a)}))},getMarkedIdx:function(){switch(b.direction){case "horizontal":return d.inArray(n.$obj.scrollLeft(),this.marks);case "vertical":return d.inArray(n.$obj.scrollTop(),this.marks);default:return this.arrayIndexOf([n.$obj.scrollLeft(),n.$obj.scrollTop()])}},isInteger:function(a){return"number"===typeof a&&0===a%1},parseLoad:function(a){var f=[];if(a)if(a instanceof Array){var c=a.length;if("horizontal"==
b.direction||"vertical"==b.direction)for(var m=0;m<c;++m){var e=a[m];if(this.isInteger(e))f.push(e);else throw"Invalid element "+e+" at index "+m+". Expected an integer. Example: [0, 34, 23]";}else for(m=0;m<c;++m)if(e=a[m],e instanceof Array&&2===e.length&&this.isInteger(e[0])&&this.isInteger(e[1]))f.push(e);else throw"Invalid element "+e+" at index "+m+". Expected a [x, y] two integers array. Example: [[0, 0], [40, 80], [40, 300]]";}else switch(b.direction){case "horizontal":case "vertical":throw"Expected an array of integers. Example: [0, 80, 300]";
default:throw"Expected an array of [x, y] arrays, where x and y are integers. Example: [[0, 0], [40, 80], [40, 300]]";}return f},loadMarks:function(a,f){try{var c=this.parseLoad(f),e=c.length;this.doClearAll(null);if("horizontal"==b.direction||"vertical"==b.direction)for(var d=0;d<e;++d)this.doToggle(null,c[d],c[d]);else for(d=0;d<e;++d)this.doToggle(null,c[d][0],c[d][1]);h.triggerHandler("resize.rsOverview");this.checkEvents(a)}catch(g){c="rsOverview.loadMarks(): "+g,window.console?console.error(c):
alert(c)}}},A=function(a,f){var c=q?d("html,body"):e.$obj;t&&c.stop(!0);var m=[0,0],g;c.each(function(){var a=d(this),b=a.scrollLeft(),a=a.scrollTop();if(0!=b||0!=a)return m[0]=b,m[1]=a,!1});switch(b.direction){case "horizontal":g=m[0]!=a.scrollLeft;break;case "vertical":g=m[1]!=a.scrollTop;break;default:g=m[0]!=a.scrollLeft||m[1]!=a.scrollTop}g&&(b.bookmarkClass&&b.bookmarkActiveClass&&k.$allBks.removeClass(b.bookmarkActiveClass),t=!0,c.animate(a,{duration:b.scrollSpeed,queue:!1,complete:function(a){t=
!1;void 0!==f&&f()}}))},D=function(a){a=function(){switch(b.direction){case "horizontal":return n.sizeX<=e.sizeX;case "vertical":return n.sizeY<=e.sizeY;default:return n.sizeX<=e.sizeX&&n.sizeY<=e.sizeY}};if(q)n.resized();else{n.resizedOverflow();var f=[e.$obj.css("overflow-x"),e.$obj.css("overflow-y")];y="hidden"==f[0]?0:r;z="hidden"==f[1]?0:r}e.resized();if(b.autoHide){if(a()){h.hide();return}h.show()}else"none"==h.css("display")&&h.show();a=h.width();var f=h.height(),c=coefY=0;"vertical"!=b.direction&&
(c=n.sizeX/a);"horizontal"!=b.direction&&(coefY=n.sizeY/f);g=Math.max(c,coefY);"vertical"!=b.direction&&(c=(e.sizeX-(n.sizeY<=e.sizeY?0:z))/a);"horizontal"!=b.direction&&(coefY=(e.sizeY-(n.sizeX<=e.sizeX?0:y))/f);g=Math.max(Math.max(c,coefY),g);if("horizontal"!=b.direction&&"vertical"!=b.direction){var c=n.sizeX/g,d=n.sizeY/g;p.width(Math.round(c)).height(Math.round(d)).css({left:Math.round(b.center?(a-c)/2:0)+"px",top:Math.round(b.center?(f-d)/2:0)+"px"})}h.triggerHandler("render.rsOverview",[!0])},
E=function(a,f){switch(b.direction){case "horizontal":if(f){var c=(e.sizeX-(n.sizeY<=e.sizeY?0:z))/g;l.width(Math.round(c));for(var d=0;d<k.marks.length;++d){var h=k.getPnt(k.marks[d]),s=k.$allBks.eq(d);s.css({left:Math.round((c-s.outerWidth())/2+h.scrollLeft/g)+"px",top:0,bottom:0})}}l.css("left",Math.round(e.$obj.scrollLeft()/g)+"px");break;case "vertical":if(f)for(c=(e.sizeY-(n.sizeX<=e.sizeX?0:y))/g,l.height(Math.round(c)),d=0;d<k.marks.length;++d)h=k.getPnt(k.marks[d]),s=k.$allBks.eq(d),s.css({top:Math.round((c-
s.outerHeight())/2+h.scrollTop/g)+"px",left:0,right:0});l.css("top",Math.round(e.$obj.scrollTop()/g)+"px");break;default:c=p.position();if(f)for(d=(e.sizeX-(n.sizeY<=e.sizeY?0:z))/g,h=(e.sizeY-(n.sizeX<=e.sizeX?0:y))/g,l.width(Math.round(d)).height(Math.round(h)),s=0;s<k.marks.length;++s){var q=k.getPnt(k.marks[s]),r=k.$allBks.eq(s);r.css({left:Math.round(c.left+(d-r.outerWidth())/2+q.scrollLeft/g)+"px",top:Math.round(c.top+(h-r.outerHeight())/2+q.scrollTop/g)+"px"})}c.left=e.$obj.scrollLeft()/g+
(b.center?c.left:0);c.top=e.$obj.scrollTop()/g+(b.center?c.top:0);l.css({left:Math.round(c.left)+"px",top:Math.round(c.top)+"px"})}t||k.checkEvents(a)},F=function(a){var d=0;void 0!==a.wheelDelta||void 0===a.originalEvent||void 0===a.originalEvent.wheelDelta&&void 0===a.originalEvent.detail||(a=a.originalEvent);a.wheelDelta&&(d=a.wheelDelta/120);a.detail&&(d=-a.detail/3);var c=a||window.event;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(d=0);void 0!==c.wheelDeltaY&&(d=c.wheelDeltaY/120);a.preventDefault?
a.preventDefault():a.returnValue=!1;"horizontal"==b.direction?e.$obj.scrollLeft(e.$obj.scrollLeft()-d*b.mousewheel):e.$obj.scrollTop(e.$obj.scrollTop()-d*b.mousewheel);return!1},G=function(a){b.bookmarkClass&&k.toggle(a)},H=function(a){b.bookmarkClass&&k.clearAll(a)},I=function(a){b.bookmarkClass&&k.gotoPrev(a)},J=function(a){b.bookmarkClass&&k.gotoNext(a)},B=function(a,d){switch(d){case "bookmarks":return k.marks;case "readonly":return b.readonly;case "center":return b.center;case "autoHide":return b.autoHide;
case "scrollSpeed":return b.scrollSpeed}return null},K=function(a,d,c){switch(d){case "bookmarks":b.bookmarkClass&&k.loadMarks(a,c);break;case "readonly":b.readonly=c;break;case "center":b.center=c;h.triggerHandler("resize.rsOverview");break;case "autoHide":b.autoHide=c;h.triggerHandler("resize.rsOverview");break;case "scrollSpeed":b.scrollSpeed=c}return B(a,d)},L=function(a){if(b.onCreate)b.onCreate(a)},M=function(){h.triggerHandler("render.rsOverview",[!1])},N=function(){h.triggerHandler("resize.rsOverview")},
O=function(a){if(!b.readonly){t&&((q?d("html,body"):e.$obj).stop(!0),t=!1);var f=p.position(),c=l.position();w=c.left-f.left;x=c.top-f.top;u=a.clientX;v=a.clientY;this.ondragstart=this.onselectstart=function(){return!1};d(document).bind("mousemove.rsOverview",C);a.preventDefault()}},C=function(a){switch(b.direction){case "horizontal":e.$obj.scrollLeft(g*(a.clientX-u+w));break;case "vertical":e.$obj.scrollTop(g*(a.clientY-v+x));break;default:e.$obj.scrollLeft(g*(a.clientX-u+w)).scrollTop(g*(a.clientY-
v+x))}a.preventDefault()},P=function(){b.readonly||d(document).unbind("mousemove.rsOverview",C)},Q=function(a){b.readonly||(A("horizontal"==b.direction?{scrollLeft:(a.offsetX-l.width()/2)*g}:{scrollTop:(a.offsetY-l.height()/2)*g},function(){k.checkEvents(a)}),a.preventDefault())},R=function(a){b.readonly||(A({scrollLeft:g*(a.offsetX-l.width()/2),scrollTop:g*(a.offsetY-l.height()/2)},function(){k.checkEvents(a)}),a.preventDefault())},S=function(){h.triggerHandler("clearBk.rsOverview");e.$obj.unbind("scroll.rsOverview",
M).unbind("resize.rsOverview",N);0!==b.mousewheel&&(q?d(window):e.$obj).unbind("DOMMouseScroll.rsOverview mousewheel.rsOverview",F);l.unbind("mousedown.rsOverview",O);d(document).unbind("mouseup.rsOverview",P).unbind("mousemove.rsOverview",C);"horizontal"==b.direction||"vertical"==b.direction?p.unbind("mousedown.rsOverview",Q):p.unbind("mousedown.rsOverview",R);h.unbind("resize.rsOverview",D).unbind("render.rsOverview",E).unbind("toggleBk.rsOverview",G).unbind("clearBk.rsOverview",H).unbind("prevBk.rsOverview",
I).unbind("nextBk.rsOverview",J).unbind("getter.rsOverview",B).unbind("setter.rsOverview",K).unbind("create.rsOverview",L).unbind("destroy.rsOverview",S);p.remove();l.remove();h.css("position","");""==h.attr("style")&&h.removeAttr("style")};"static"===h.css("position")&&h.css("position","relative");p=d("<span>").addClass(b.contentClass).css("position","absolute");l=d("<span>").addClass(b.viewportClass).css("position","absolute");h.append(p).append(l);"horizontal"!=b.direction&&"vertical"!=b.direction||
p.css({left:0,top:0,bottom:0,right:0});switch(b.direction){case "horizontal":l.css({top:0,bottom:0});break;case "vertical":l.css({left:0,right:0})}e.$obj=d(b.monitor);n.$obj=q?d(document):e.$obj;if(q)switch(b.direction){case "horizontal":$scrollAnim=d({scrollLeft:0});break;case "vertical":$scrollAnim=d({scrollTop:0});break;default:$scrollAnim=d({scrollLeft:0,scrollTop:0})}e.$obj.bind("scroll.rsOverview",M).bind("resize.rsOverview",N);0!==b.mousewheel&&(q?d(window):e.$obj).bind("DOMMouseScroll.rsOverview mousewheel.rsOverview",
F);l.bind("mousedown.rsOverview",O);d(document).bind("mouseup.rsOverview",P);"horizontal"==b.direction||"vertical"==b.direction?p.bind("mousedown.rsOverview",Q):p.bind("mousedown.rsOverview",R);h.bind("resize.rsOverview",D).bind("render.rsOverview",E).bind("toggleBk.rsOverview",G).bind("clearBk.rsOverview",H).bind("prevBk.rsOverview",I).bind("nextBk.rsOverview",J).bind("getter.rsOverview",B).bind("setter.rsOverview",K).bind("create.rsOverview",L).bind("destroy.rsOverview",S);h.triggerHandler("resize.rsOverview");
h.triggerHandler("create.rsOverview")};d.fn.rsOverview=function(h){var b=function(){return this.trigger("resize.rsOverview")},r=function(){return this.trigger("toggleBk.rsOverview")},u=function(){return this.trigger("clearBk.rsOverview")},v=function(){return this.trigger("prevBk.rsOverview")},w=function(){return this.trigger("nextBk.rsOverview")},x=function(b){if("string"==typeof arguments[0]){var d=1==arguments.length?"getter":2==arguments.length?"setter":null;if(null!=d)return this.eq(0).triggerHandler(d+
".rsOverview",arguments)}};if("string"==typeof h){var p=Array.prototype.slice.call(arguments,1);switch(h){case "invalidate":return b.apply(this);case "toggleBk":return r.apply(this);case "clearBk":return u.apply(this);case "prevBk":return v.apply(this);case "nextBk":return w.apply(this);case "destroy":return this.trigger("destroy.rsOverview");case "option":return x.apply(this,p);default:return this}}var l=d.extend({},d.fn.rsOverview.defaults,h),b=function(){var b=d("<div style='visibily: hidden; overflow: scroll; width: 100px;'></div>");
d("body").append(b);try{var g=b[0].clientWidth;return 100-(100==g||0==g?83:g)}finally{b.remove()}},q=l.monitor===window||d(l.monitor).is(d(window))?0:b();return this.each(function(){new T(d(this),l,q)})};d.fn.rsOverview.defaults={monitor:d(window),direction:"both",center:!0,autoHide:!1,readonly:!1,scrollSpeed:"normal",bookmarkClass:"bookm",bookmarkActiveClass:"active",bookmarkHint:"Go to bookmark",contentClass:"content",viewportClass:"viewport",mousewheel:0,onCreate:null,onChangeCtrlState:null,onChangeToggle:null}})(jQuery);